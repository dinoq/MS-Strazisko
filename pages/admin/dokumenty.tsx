import type { NextPage } from 'next'
import Head from 'next/head'
import Link from 'next/link'
import { useState } from 'react'
import { getApiURL } from '../../utils'

const AdminDocumentsPage: NextPage = (props: any) => {
  const documents: Array<any> = (props.docs) ? props.docs : [];
  const [showFileManager, setShowFileManager] = useState(true);

  return (
    <div className={""}>
      <Head>
        <title>Stránky</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={""}>
        <h1 className="text-center mb-4">Dokumenty</h1>
        <div className={"form-wrapper"}>
          <table className={""}>
            <thead>
              <tr className={""}>
                <th className={""}>Název dokumentu</th>
                <th className={""}>URL</th>
                <th className={""}>Akce</th>
              </tr>
            </thead>
            <tbody>
              {documents.map((doc, index) => {
                console.log('doc: ', doc);
                const url = (doc?.url?.startsWith("/")) ? doc.url.substring(1) : doc.url;
                return (
                  <tr key={"doc-" + index} className={""}>
                    <td className={""}>{doc.name}</td>
                    <td className={""}><Link href={"/dokumenty/" + url}><a target="_blank" className={"link"}>{"/dokumenty/" + url}</a></Link></td>
                    <td className={"actions"}><span className={"link-danger"}>Smazat</span><span className={"link"}>Přejmenovat</span></td>
                  </tr>
                )
              })}
              <tr>
                <th colSpan={4} className={"text-center"}>
                  <span className={"link " + "add-document-btn"}>Přidat nový dokument</span>
                  {showFileManager && <FileManager />}
                </th>
              </tr>
            </tbody>
          </table>
        </div>
      </main>
    </div>
  )
}

const FileManager = (props) => {
  const [fileLabel, setFileLabel] = useState("Vyberte soubor")

  const fileChange = (event)=>{
    if(event?.target?.files[0]?.name?.length){
      	setFileLabel("Vybráno: " + event.target.files[0].name);
    }

  }

  return (
    <div>
      <form className="d-flex flex-column">
        <input type="file" onChange={fileChange} name="file" id="file" className={"hidden-file-input"} />
        <div className="d-flex justify-content-center">
          <label htmlFor="file" className="hidden-file-input-label">{fileLabel}</label>
        </div>
        <div className="d-flex justify-content-center">
          <input className="button" type="submit" value="Uložit" />
          <input className="button button-danger" type="button" value="Zrušit" />
        </div>
      </form>
    </div>
  )
}
export default AdminDocumentsPage

export const getServerSideProps = async (req, res) => {
  let docs = await (await fetch(getApiURL("getDocuments"))).json();

  return {
    props: { docs },
  };
}